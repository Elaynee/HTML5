<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>beforeRunningCommand</key>
	<string>saveActiveFile</string>
	<key>command</key>
	<string>###	Preview in OmniWeb  = UNTESTED!! Please confirm that it is working
### v1.0. 2005-03-29
###
###	CONFIG OPTION::	Set the TM_PROJECT_SITEURL in your TM Project Window Info Button in the following form: [ http://your.site.ext/ ]
###

# 1. Check if we have a SITE_URL or not
if [ "$TM_PROJECT_SITEURL" != "" ]
then
	#	Yes, we do have a SITE URL defined, so we need to work out which subdir we're in, if any
	TM_SubDirs=`echo $TM_FILEPATH | sed "s|^$TM_PROJECT_DIRECTORY/\(.*\)$TM_FILENAME\$|\1|"`
	#echo Debug::TM_SUBDIR value "$TM_SubDirs"
	activeURL=$TM_PROJECT_SITEURL$TM_SubDirs$TM_FILENAME
	#echo Debug::TM_SUBDIR value "$activeURL"
else
	#	No, we don't have a SITE URL
	activeURL=file://$TM_FILEPATH
	#echo Debug::TM_SUBDIR value "$activeURL"
fi
#	2.	Check if OmniWeb is running, if so open a new tab in the same window else open a new window 
if [[ $(ps -xc|grep -i OmniWeb ) ]];
then
	# echo OmniWeb is running, so open the url in a new window
	printf "set theActiveURL to \"$(echo $activeURL)\" \n tell application \"OmniWeb\" \n activate \n to GetURL theActiveURL \n end tell" | osascript

else
	# echo OmniWeb is NOT running, so open the url in the front window
	printf "set theActiveURL to \"$(echo $activeURL)\" \n tell application \"OmniWeb\" \n activate \n to GetURL theActiveURL \n end tell" | osascript
fi
### end
</string>
	<key>input</key>
	<string>none</string>
	<key>name</key>
	<string>Preview in OmniWeb</string>
	<key>output</key>
	<string>discard</string>
	<key>scope</key>
	<string>text.html</string>
	<key>uuid</key>
	<string>CB0784DB-A102-11D9-A5A2-000D93C8BE28</string>
</dict>
</plist>
